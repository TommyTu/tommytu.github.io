<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  




<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="File SystemAbstractionFilea named collection of data in a file system. For example,the programs /Applications/Calculator or /ProgramFiles/TextEdit areeach files, as are the data /home/Bob/corresponden">
<meta property="og:type" content="article">
<meta property="og:title" content="File system notes">
<meta property="og:url" content="http://yoursite.com/2016/05/02/File system notes/index.html">
<meta property="og:site_name" content="Tommy's website">
<meta property="og:description" content="File SystemAbstractionFilea named collection of data in a file system. For example,the programs /Applications/Calculator or /ProgramFiles/TextEdit areeach files, as are the data /home/Bob/corresponden">
<meta property="og:image" content="http://yoursite.com/Users/tommytu/Desktop/屏幕快照 2016-05-02 上午9.42.32.png">
<meta property="og:image" content="http://yoursite.com/Users/tommytu/Desktop/屏幕快照 2016-05-02 上午9.43.40.png">
<meta property="og:image" content="http://yoursite.com/Users/tommytu/Desktop/屏幕快照 2016-05-02 上午10.08.23.png">
<meta property="og:image" content="http://yoursite.com/Users/tommytu/Desktop/屏幕快照 2016-05-02 上午10.26.46.png">
<meta property="og:updated_time" content="2016-05-02T02:58:29.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="File system notes">
<meta name="twitter:description" content="File SystemAbstractionFilea named collection of data in a file system. For example,the programs /Applications/Calculator or /ProgramFiles/TextEdit areeach files, as are the data /home/Bob/corresponden">
<meta name="twitter:image" content="http://yoursite.com/Users/tommytu/Desktop/屏幕快照 2016-05-02 上午9.42.32.png">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'Author'
    }
  };
</script>

  <title> File system notes | Tommy's website </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Tommy's website</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                File system notes
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-05-02T10:41:39+08:00" content="2016-05-02">
              2016-05-02
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="File-System"><a href="#File-System" class="headerlink" title="File System"></a>File System</h1><h2 id="Abstraction"><a href="#Abstraction" class="headerlink" title="Abstraction"></a>Abstraction</h2><h3 id="File"><a href="#File" class="headerlink" title="File"></a>File</h3><p>a named collection of data in a file system. For example,the programs /Applications/Calculator or /ProgramFiles/TextEdit areeach files, as are the data /home/Bob/correspondence/letter-to-mom.txtor /home/Bob/Classes/OS/hw1.txt.</p>
<ul>
<li>file metadata: information about the file that is understood and managed by the operatingsystem.</li>
<li>file data: whatever information a user or application puts in it.</li>
</ul>
<h3 id="Directory"><a href="#Directory" class="headerlink" title="Directory"></a>Directory</h3><p>a directory is a list ofhuman-readable names and a mapping from each name to a specific underlyingfile or directory. One common metaphor is that a directory is a folder thatcontains documents (files) and other folders (directories).</p>
<p>Concept: Home directory(cd)  Root directory</p>
<p>Directory in Linux must be acrylic cycle!!!</p>
<p><em>*To execute a file, the operating system must determine whether it is a binary file or ascript. Linux does this by having executable files begin with a magic number that identifiesthe file’s format. For example, ELF binary executables begin with the four bytes 0x7f,0x45, 0x4c, and 0x46 (the ASCII characters DEL, E, L, and F); Similarly,script files begin with #! followed by the name of the interpreter that should be used torun the script (e.g., a script might begin with #!/bin/sh to be executed using the Bourneshell or #!/usr/bin/perl to be executed using the perl interpreter.</em></p>
<p><em>Alternative approaches include determining a file’s type by its name extension—thecharacters after the last dot (.) in the file’s name (e.g., .exe, .pl, or .sh)—or includinginformation about a file’s type in its metadata</em></p>
<h3 id="Hard-link"><a href="#Hard-link" class="headerlink" title="Hard link"></a>Hard link</h3><p>The mapping between a name and the underlying file is hard link.</p>
<p><strong>difference</strong> between soft link: A symbolic linkis a directory mappings from a file name to another file name. </p>
<h3 id="Volumn"><a href="#Volumn" class="headerlink" title="Volumn"></a>Volumn</h3><p>A volume is a collection of physical storage resources that form alogical storage device.</p>
<p>A single computer can make use of multiple file systems stored on multiple volumes by <strong>mounting</strong> multiple volumes in a single logical hierarchy. Mounting a volume on an existing file system creates a mapping from some path in the existing file system to the root directory of the mounted volume’s file system and lets the mounted file system control mappings for all extensions of that path.</p>
<h4 id="example"><a href="#example" class="headerlink" title="example"></a>example</h4><p> <img src="/Users/tommytu/Desktop/屏幕快照 2016-05-02 上午9.42.32.png" alt="屏幕快照 2016-05-02 上午9.42.32"></p>
<p> <img src="/Users/tommytu/Desktop/屏幕快照 2016-05-02 上午9.43.40.png" alt="屏幕快照 2016-05-02 上午9.43.40"></p>
<h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><h3 id="creating-and-delete-files"><a href="#creating-and-delete-files" class="headerlink" title="creating and delete files"></a>creating and delete files</h3><p><code>Create(pathname)</code> creates a new file that has initial metadata but no other data, and it creates a name for that file in a directory</p>
<p><code>Link(existingName, newName)</code> creates a hard link—a new path name for an existing file. After asuccessful call to link(), there are multiple path names that refer to the sameunderlying .</p>
<p><code>unlink(pathName)</code> Remove the specified name for a file from its direc-tory; if that was the only name for the underlyingfile, then remove the file and free its resources.</p>
<p><code>mkdir(pathName)</code>  Create a new directory with the specified name.</p>
<p><code>rmdir(pathName)</code>  Remove the directory with the specified name.</p>
<h3 id="Open-and-close"><a href="#Open-and-close" class="headerlink" title="Open and close"></a>Open and close</h3><p><code>fileDescriptor =open(pathName)</code> Prepare the calling process for access to the speci-fied file (e.g., check access permissions and initial-ize kernel data structures for tracking per-processstate of open files)</p>
<p><code>close(fileDescriptor)</code> Release resources associated with the specifiedopen file</p>
<p>Encapsulate <code>read</code> into <code>open</code> Benefits:</p>
<ul>
<li>path parsing and permission checkingcan be done just when a file is opened and need not be repeated on each reador write.</li>
<li>when a process opens a file, the operating system creates adata structure that stores information about the process’s open file such as thefile’s ID, whether the process can write or just read the file, and a pointer tothe process’s current position within the file.</li>
</ul>
<h3 id="File-access"><a href="#File-access" class="headerlink" title="File access"></a>File access</h3><p><code>read(fileDescriptor, buf, len)</code> Read len bytes from the process’s current positionin the open file fileDescriptor and copy the re-sults to a bu↵er buf in the application’s memory.</p>
<p><code>write(fileDescriptor, len, buf)</code> Write len bytes of data from a buffer buf in theprocess’s memory to the process’s current positionin the open file fileDescriptor.</p>
<p><code>seek(fileDescriptor, offset)</code> Change the process’s current position in the openfile fileDescriptor to the specified offset.</p>
<p><code>dataPtr =mmap(fileDescriptor, off, len)</code> Set up a mapping between the data in the filefileDescriptor from off to off + len and anarea in the application’s virtual memory fromdataPtr to dataPtr + len.</p>
<p><code>munmap(dataPtr, len)</code> Remove the mapping between the application’svirtual memory and a mapped file.</p>
<p><code>fsync(fileDescriptor)</code> Force to disk all bfeuffed, dirty pages for the fileassociated with fileDescriptor. (for reliability)</p>
<h2 id="Software-Layer"><a href="#Software-Layer" class="headerlink" title="Software Layer"></a>Software Layer</h2><p> <img src="/Users/tommytu/Desktop/屏幕快照 2016-05-02 上午10.08.23.png" alt="屏幕快照 2016-05-02 上午10.08.23"></p>
<h3 id="API-and-Performance"><a href="#API-and-Performance" class="headerlink" title="API and Performance"></a>API and Performance</h3><ul>
<li><p>System calls and libraries.</p>
<blockquote>
<p>For example, in Linux, applications can access files directly using system calls (e.g., open(), read(), write(), and close().) Alternatively, applications can use the stdio library calls (e.g., fopen(), fread(), fwrite(), and fclose()). The advantage of the latter is that the library includes buffers to aggregate a program’s small reads and writes into system calls that access larger blocks, which can reduce overheads. For example, if a program uses the library function fread() to read 1 byte of data, the fread() implementation may use the read() system call to read a larger block of data (e.g., 4 KB) into a buffer maintained by the library in the application’s address space. Then, if the process calls fread() again to read another byte, the library just returns the byte from the buffer without needing to do a system call.</p>
</blockquote>
</li>
<li><p>Block cache. Typical storage devices are much slower than a computer’s main memory. The operating system’s block cache therefore caches recently read blocks, and it buffers recently written blocks so that they can be written back to the storage device at a later time.</p>
</li>
<li><p>Prefetching. Operating systems use prefetching to improve I/O performance. For example, if a process reads the first two blocks of a file, the operating system may prefetch the next ten blocks.</p>
</li>
</ul>
<h3 id="Device-Driver"><a href="#Device-Driver" class="headerlink" title="Device Driver"></a>Device Driver</h3><p>Device drivers translate between the high level abstractions implemented by the operating system and the hardware-specific details of I/O devices.</p>
<p>Layering helps simplify operating systems by providing common ways to access various classes of devices. For example, for any given operating system, storage device drivers typically implement a standard block device interface that allows data to be read or written in fixed-sized blocks (e.g., 512, 2048, or 4096 bytes).</p>
<p>To improve <strong>reliability</strong>, operating systems are increasingly using protection techniques similar to those used to isolate user-level programs to isolate device drivers from the kernel and from each other.</p>
<ul>
<li><p>Memory-mapped I/O</p>
<p>Each I/O device has controller with a set of registers that can be written and read to transmit commands and data to and from the devices.  Memory-mapped I/O maps each device’s control registers to a range of physical addresses on the memory bus. Reads and writes by the CPU to this physical address range do <strong>not</strong> go to main memory. Instead, they go to registers on the I/O devices’s controllers. Thus, the operating system’s keyboard device driver might learn the value of the last key pressed by reading from physical address, say, 0xC00002000.</p>
<p><img src="/Users/tommytu/Desktop/屏幕快照 2016-05-02 上午10.26.46.png" alt="屏幕快照 2016-05-02 上午10.26.46"></p>
<p>physical addresses from 0xC0001000 to 0xC0001FFF access registers in the disk controller.</p>
</li>
<li><p>DMA (direct memory access)</p>
<p>When using direct memory access (DMA), the I/O device copies a block of data between its own internal memory and the system’s main memory.</p>
<p>simple operating system could use memory-mapped I/O to provide a target physical address, transfer length, and operation code to the device. Then, the device copies data to or from the target address without requiring additional processor involvement.</p>
</li>
</ul>
<h3 id="Puting-together"><a href="#Puting-together" class="headerlink" title="Puting together"></a>Puting together</h3><ol>
<li>a process issues a system call like read() to read data from disk into the process’s memory, the operating system moves the calling thread to a wait queue. </li>
<li>the operating system uses memory-mapped I/O both to tell the disk to read the requested data and to set up DMA so that the disk can place that data in the kernel’s memory.</li>
<li>The disk then reads the data and DMAs it into main memory; once that is done, the disk triggers an interrupt. </li>
<li>The operating system’s interrupt handler then copies the data from the kernel’s buffer into the process’s address space. </li>
<li>Finally, the operating system moves the thread the ready list. When the thread next runs, it will returns from the system call with the data now present in the specified buffer.</li>
</ol>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><p>Anderson, Thomas. “Operating Systems Principles and Practice, Volume 4: Persistent Storage“</p>

      
    </div>
    
    <div>
      
        
      
    </div>

    <div>
      
        
      
    </div>

    <footer class="post-footer">
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/04/22/hello-world/" rel="next" title="Hello World">
                <i class="fa fa-chevron-left"></i> Hello World
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/05/02/Operating-System-File-system/" rel="prev" title="Operating System--File system">
                Operating System--File system <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/default_avatar.jpg"
               alt="Tommy Tu" />
          <p class="site-author-name" itemprop="name">Tommy Tu</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">3</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#File-System"><span class="nav-number">1.</span> <span class="nav-text">File System</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Abstraction"><span class="nav-number">1.1.</span> <span class="nav-text">Abstraction</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#File"><span class="nav-number">1.1.1.</span> <span class="nav-text">File</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Directory"><span class="nav-number">1.1.2.</span> <span class="nav-text">Directory</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Hard-link"><span class="nav-number">1.1.3.</span> <span class="nav-text">Hard link</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Volumn"><span class="nav-number">1.1.4.</span> <span class="nav-text">Volumn</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#example"><span class="nav-number">1.1.4.1.</span> <span class="nav-text">example</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#API"><span class="nav-number">1.2.</span> <span class="nav-text">API</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#creating-and-delete-files"><span class="nav-number">1.2.1.</span> <span class="nav-text">creating and delete files</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Open-and-close"><span class="nav-number">1.2.2.</span> <span class="nav-text">Open and close</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#File-access"><span class="nav-number">1.2.3.</span> <span class="nav-text">File access</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Software-Layer"><span class="nav-number">1.3.</span> <span class="nav-text">Software Layer</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#API-and-Performance"><span class="nav-number">1.3.1.</span> <span class="nav-text">API and Performance</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Device-Driver"><span class="nav-number">1.3.2.</span> <span class="nav-text">Device Driver</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Puting-together"><span class="nav-number">1.3.3.</span> <span class="nav-text">Puting together</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Reference"><span class="nav-number">1.3.4.</span> <span class="nav-text">Reference</span></a></li></ol></li></ol></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Tommy Tu</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  



  
  
  

  

  

</body>
</html>
